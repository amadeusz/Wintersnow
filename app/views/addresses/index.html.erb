<p id="notice"><%= notice %></p>

<table>
	<tr>
		<th><%= image_tag 'icons/key.png' %></th>
		<th></th>
		<th><%= image_tag 'icons/user.png' %></th>
		<th><%= image_tag 'icons/comments.png' %></th>
		<th></th>
		<th></th>
		<th></th>
	</tr>
<% @addresses.each do |address| %>
	<tr>
		<td><%= link_to " #{address.id} ", edit_address_path(address)%></td>
		<td>
		<%
			opis = nil, dodatki = nil
			opis = address.opis.limit(50) if address.opis != ''
			dodatki = [address.xpath, address.css, address.regexp].join(" ").limit(50)
			adres = address.adres.limit(50)
		
		%>
			<% if opis %><p><strong><%= opis %></strong></p><% end %>
			<p><a href="<%= adres %>"><%= adres  %></a></p>
			<% if dodatki %><p class="dodatki"><%= dodatki  %></p><% end %>
		</td>

		<td> <%= address.users.length %>
			<div>
				<% address.users.each do |user| %>
				<p> <%= user.klucz %> </p>
				<% end %>
			</div>
		</td>
		<td>
			<% if address.messages != [] %>
				<% address.messages.each do |komunikat| %> 
					<span class="komunikat_id"><%= link_to komunikat.id, edit_message_path(komunikat) %><div class="ad_message">
						<%= komunikat.tresc[0..256] %><%= "..." if komunikat.tresc.length > 256 %>
						<%= link_to image_tag('icons/destroy.png'), message_path(komunikat), :confirm => 'Are you sure?', :method => :delete %>
					</div></span>
				<% end %>
			<% end %>
		</td>
		
		<td><%= skroc_date(address.data_mod) %><br/><span style="color: #999"><%= skroc_date(address.data_spr) %></span></td>
		<td><% if address.blokada %><%= image_tag "icons/exclamation.png" %><% end %></td> 
		
		<td><%= link_to image_tag('icons/keyboard.png'), edit_address_path(address) %>
			<%= link_to image_tag('icons/destroy.png'), address_path(address), :confirm => 'Are you sure?', :method => :delete %></td>
	</tr>
<% end %>
</table>

<div class="actions"><%= link_to 'dodaj', new_address_path %></div>
